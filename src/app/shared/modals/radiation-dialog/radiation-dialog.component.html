<div class="modal-dialog" role="document">
  <div class="modal-content">

    <form [formGroup]="form" (submit)="valider()">
      <fieldset [disabled]="isLoading">
        <div class="modal-header"></div>
        <div class="modal-body">

          <ng-container *ngIf="!isProcessed">

            <h3 class="mb-4">Confirmation de la demande de résiliation</h3>

            <app-date label="Date de résiliation" controlName="date" [formGroup]="form" [required]="true"
              [validators]="dateRadiationWithinRangeValidator" [validationMessages]="dateRadiationValidationMessage"
              (change)="onDateResiliationChanged()">
            </app-date>

            <app-select *ngIf="needMotif" label="Motif" controlName="motif" [formGroup]="form"
              [options]="motifsRadiation" (valueChanged)="motifChanged($event)" required="true">
            </app-select>

            <app-checkbox [formGroup]="form" controlName="goPortabilite" *ngIf="canDoPortabilite" [initialValue]="false"
              [required]="false" label="Portabilité" (change)="checkboxChanged($event)">
            </app-checkbox>

            <div class="alert alert-primary" role="alert" *ngIf="canDoPortabilite">
              La portabilité des droits est un dispositif permettant à un salarié de continuer à être couvert
              gratuitement par la complémentaire santé ou prévoyance groupe de votre entreprise pour une durée maximum
              de 12 mois.
            </div>

            <app-select *ngIf="displayChoixPortabilite && !rechercheValeursMoisPortabilite"
              label="Durée de portabilité souhaitée" controlName="nbMoisPortabilite" [formGroup]="form" required="true"
              [options]="moisPortabilite">
            </app-select>
            <div *ngIf="displayChoixPortabilite && rechercheValeursMoisPortabilite" class="spinner-border text-primary"
              role="status">
              <span class="sr-only">Chargement...</span>
            </div>
            <div *ngIf="displayChoixPortabilite" class="alert alert-primary" role="alert">
              Votre salarié recevra une demande de pièce justificative pour la mise en place de la portabilité.
            </div>

          </ng-container>

          <ng-container *ngIf="isProcessed">

            <div *ngIf="isRadiationDone" class="text-center">
              <app-icon name="clos" klass="icon icon-big icon-clos"></app-icon>
              <h3>Votre demande de résiliation a bien été prise en compte.</h3>
            </div>

            <div *ngIf="!isRadiationDone" class="text-center">
              <app-icon name="alerte" klass="icon icon-big icon-alerte"></app-icon>
              <h3>Votre demande n'a pas pu être traitée. Veuillez réessayer ultérieurement.</h3>
            </div>

          </ng-container>

        </div>

        <div class="modal-footer">

          <ng-container *ngIf="!isProcessed">
            <button type="button" class="btn btn-grey" (click)="close()">Annuler</button>
            <button type="submit" class="btn btn-default" [class.btn-loading]="isLoading"
              [disabled]="form.invalid">Résilier</button>
          </ng-container>

          <ng-container *ngIf="isProcessed">
            <button type="button" class="btn btn-default" (click)="close()">Ok</button>
          </ng-container>

        </div>

      </fieldset>
    </form>

  </div>
</div>
